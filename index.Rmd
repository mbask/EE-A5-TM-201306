---
title       : A5 Technical meeting
subtitle    : Jyväskylä (Finland), June 18, 2013
author      : Giorgio Matteucci, Marco Bascietto
job         : CNR - IBAF
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow      # 
widgets     : []            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
github:
  user: mbask
  repo: EE-A5-TM-201306
---
```{r "libraryLoad", cache=FALSE, include=FALSE, echo=FALSE}
library(data.table)
library(RSQLite)
library(sqlutils)
library(plyr)
library(xtable)
suppressPackageStartupMessages(library(googleVis))

options(gvis.plot.tag='chart')
assignInNamespace("cedta.override","slidify","data.table") 
```


```{r "dbSetup", cache=FALSE, include=FALSE, echo=FALSE}
# Setup e connessione SQLite -----------------------------------------------


sqlPaths("~/Documents/Academy/IBAF/ENVEUROPE/A5Finland/sql")

db.sqlite.cfg  <- list(
  fName    = "~/Documents/Academy/IBAF/ENVEUROPE/A5/DB/EEA5SiteParameters.db"
  , driver =  dbDriver("SQLite")
  , query  = list("getAvailableDataByCountry")
  , queryTitle = list("Uploaded Data")
  , countryNames = c("Austria", "Bulgaria", "Finland", "Germany", "Hungary", "Italy", "Lithuania", "Poland", "Romania", "Spain", "Sweden")
)

dbConnection <- with(db.sqlite.cfg, dbConnect(driver, dbname = fName))

```

## Statistiche generali

1. Edit YAML front matter
2. Write using R Markdown
3. Use an empty line followed by three dashes to separate slides!

---
## Andamento della sottomissione



---
## Problemi incontrati nella sottomissione

* FTP
* DEIMS
* Data tool
* Google Drive



---
## Proposte di soluzioni

* FTP
* DEIMS
* Data tool
*publish("mbask", "EE-A5-TM-201306")
 Google Drive



---
## Statistiche per Nazione

```{r "countryRawDataQuery", echo=FALSE, cache=FALSE, results='asis', warning=FALSE}
sqlQueryToDataTable <- function(countryName, sqlQuery = db.sqlite.cfg$query) {
  data.table(
    execQuery(sqlQuery, connection = dbConnection, countryName = countryName)
    , key = c("siteLTERCode", "siteName", "domainName")
  )
}
# Get Country data
countryRawData_l <- lapply(db.sqlite.cfg$countryNames, sqlQueryToDataTable)
# Convert Lat and Long coordinates in Lat:Long
countryRawData_l <- lapply(
  countryRawData_l
  , function(country_dt) country_dt[, latLong := paste(siteLat, siteLong, sep = ":")]
  )

aggregatreByParameter <- function(country_df) {
  if (nrow(country_df) > 0) {
    tmp_df <- ddply(
      country_df
      , .(parameterName)
      , summarize
      , Count = length(parameterName)
      )
  } else {
    tmp_df <- data.frame(parameterName = "None", Count = "N/A")
  }
  colnames(tmp_df) <- c("Parameter name", "Sites")
  tmp_df
}

# Aggregate per parameter name
countryAggrData_l <- countryRawData_l
countryAggrData_l <- lapply(countryAggrData_l, aggregatreByParameter)
```


---
## Austria

```{r "Austria", echo=FALSE, cache=FALSE, results='asis', warning=FALSE}
tmp_dt <- unique(countryRawData_l[[1]])
plot(
  gvisMap(
    tmp_dt
    , locationvar = "latLong"
    , tipvar      = "siteName"
    , options     = list(
      mapType     = 'terrain'
      , useMapTypeControl = TRUE
      , width = 800
      , height = 200
      )
    , chartid = "CountryPlotAustria"
    )
  )
tmp_df <- countryAggrData_l[[1]]
print(
  xtable(
    head(tmp_df[with(tmp_df, order(-Sites)), ], 15))
  , type = 'html'
  , html.table.attributes = ''
  , include.rownames = FALSE
  )
```


---
## Bulgaria

```{r "Bulgaria", echo=FALSE, cache=FALSE, results='asis', warning=FALSE}
tmp_dt <- unique(countryRawData_l[[2]])
plot(
  gvisMap(
    tmp_dt
    , locationvar = "latLong"
    , tipvar      = "siteName"
    , options     = list(
      mapType     = 'terrain'
      , useMapTypeControl = TRUE
      , width = 800
      , height = 200
      )
    , chartid = "CountryPlotBulgaria"
    )
  )
tmp_df <- countryAggrData_l[[2]]
print(
  xtable(
    head(tmp_df[with(tmp_df, order(-Sites)), ], 15))
  , type = 'html'
  , html.table.attributes = ''
  , include.rownames = FALSE
  )
```




---
## Finland

```{r "Finland", echo=FALSE, cache=FALSE, results='asis', warning=FALSE}
tmp_dt <- unique(countryRawData_l[[3]])
plot(
  gvisMap(
    tmp_dt
    , locationvar = "latLong"
    , tipvar      = "siteName"
    , options     = list(
      mapType     = 'terrain'
      , useMapTypeControl = TRUE
      , width = 800
      , height = 200
      )
    , chartid = "CountryPlotFinland"
    )
  )
tmp_df <- countryAggrData_l[[3]]
print(
  xtable(
    head(tmp_df[with(tmp_df, order(-Sites)), ], 15))
  , type = 'html'
  , html.table.attributes = ''
  , include.rownames = FALSE
  )
```


---
## Germany



---
## Hungary


---
## Italy


---
## Lithuania



---
## Poland



---
## Romania



---
## Spain



---
## Sweden




---
## Stat aggregate oer dominio



---
## I parametri più misurati per dominio


---
## Kick off discussion

1. Obiettivo: pubblicazione peer-review
2. Analisi spaziale (non temporale)

* Panel esperti di dominio? -> 3 progetti
* Singolo panel inter-domain? -> 1 progettone
* 

```{r "closeDBConnection", cache=FALSE, include=FALSE, echo=FALSE}
dbDisconnect(dbConnection)
```